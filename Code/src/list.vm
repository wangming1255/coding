<%@ page contentType="text/html; charset=UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib prefix="datatables"
	uri="http://github.com/dandelion/datatables"%>
<meta name="decorator" content="tzxm" />
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
<META HTTP-EQUIV="Cache-Control" CONTENT="no-cache">
<META HTTP-EQUIV="Expires" CONTENT="0">
<c:set var="ctx" value="${pageContext.request.contextPath}" />
<!DOCTYPE HTML>
<html lang="cn">
<head>
<title>${meta.tableDesc}列表</title>
</head>
</div>
<body>
	<script type="text/javascript" src="${ ctx }/static/js/bootstrap.js"></script>
	<%@ include file="/WEB-INF/views/dnt-bcm/config_center/system/main/inferActions.jsp" %>
	<div id="main-content">
		<div class="container-fluid">
			<ul class="breadcrumb">
				<shiro:lacksRole name="ADMINISTRATOR">
					<li><a href="<c:url value="/itsm" />">首页</a><span class="divider">&raquo;</span></li>
				</shiro:lacksRole>
				<li><a href="<c:url value="/itsm/system" />">系统管理</a><span class="divider">&raquo;</span></li>
				<li class="active">${meta.tableDesc}</li>
			</ul>
			<div class="row-fluid">
		      <div class="span12">
		        <div class="nonboxy-widget">
		          
		          
		          
		          <div class="query-form">
						<form action="${ ctx }/invest/${meta.l_domainClassName}/list" id="query-form" method="post">
							<table width="100%">
								<tr>
									#foreach( ${col} in ${meta.cols} )
										<td>${col.colDesc}</td>
										<td><input type="text" name="${col.fieldName}" id="${col.fieldName}" value="#@@#{vo.${col.fieldName}}"/></td>
									#end
								</tr>
								<tr>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td class="center">
										<button type="submit" class="btn"><span class="icon-search"></span>查询</button>
									</td>
									<td class="center">
										<button type="button" class="btn" onclick="history.back()"><span class="icon-off"></span>退出</button>
									</td>
								</tr>
							</table>
						</form>
					</div>
				<div class="widget-head">
		            <h5 class="pull-left"><em class="black-icons list_images"></em> ${meta.tableDesc}列表</h5>
		            <div class="pull-right">
		               <c:if test="${ canCreate }">
		               	   <a href="<c:url value="/invest/${meta.l_domainClassName}/toAdd" />" class="btn adapt-btn"><span class="icon-plus"></span>新增预警</a>
		               </c:if>
		               <c:if test="${ canDelete }">
		               	   <a href="javascript:void(0)" id="removeBatch" class="btn"><span class="icon-remove"></span> 批量删除</a>
		               </c:if>
		             </div>
		          </div>
		          <div class="tab-content">
						<table id="taskTemplateList"
							class="data-tbl-striped table table-striped table-bordered dataTable"
							bsort="false" aria-describedby="taskTemplateList_info"
							style="width: 1256px;">
							<thead>
								<tr role="row">
									<th width="7%" name="checkboxMess" class="sorting_disabled"
										role="columnheader" rowspan="1" colspan="1" aria-label=""
										><input type="checkbox" value="test"
										onclick="checkAll()"></th>
									
									#foreach( ${col} in ${meta.cols} )
										<th width="15%" class="center sorting" role="columnheader" tabindex="0"
										aria-controls="taskTemplateList" rowspan="1" colspan="1"
										aria-label="${col.colDesc}: activate to sort column ascending"
										>${col.colDesc}</th>
									#end
									
									<th class="center sorting_disabled" id="td-operates"
										aria-index="7" role="columnheader" rowspan="1" colspan="1"
										aria-label="操作" >操作</th>
								</tr>
							</thead>
							<tbody id="tbody">
								<c:forEach items="${list}" var="item">
									<tr class="odd">
										<td class=" sorting_1" style="width: 4%;">
											<input class="checkId" type="checkbox" value="#@@#{item.${meta.primaryKeyField}}">
										</td>
										
										#foreach( ${col} in ${meta.cols} )
											<td class="center" style="width: 7%;">#@@#{item.${col.fieldName} }</td>
										#end	
											
										<td class="center">
											<div class="btn-group pull-right" >
												<button class="btn dropdown-toggle riskDef-btn" data-toggle="dropdown">
													<i class="icon-cog "></i>
													<span class="caret"></span>
												</button>
												<ul class="dropdown-menu" style="min-width: 86px">
													<li>
														<a href="${ ctx }/invest/${meta.l_domainClassName}/toEdit?id=#@@#{item.${meta.primaryKeyField} }">编辑</a>
													</li>
													<li>
														<a onclick="delRecord(#@@#{item.${meta.primaryKeyField} })" href="javascript:void(0)">删除</a>
													</li>
												</ul>
											</div
										</td>
									</tr>
								</c:forEach>
							</tbody>
						</table>
					</div>
				</div>
		      </div>
		   </div>
    	</div> 
	</div>
	<form action="${ctx}/invest/${meta.l_domainClassName}/del" id="delForm" method="post">
		<input type="hidden" name="ids" id="ids" value=""/>
		<input type="hidden" name="pIds" id="pIds" value=""/>
	</form>
	<script type="text/javascript">
	$(document).ready(function(){
		$(".riskDef-btn").on("click",function(){
			$(".dropdown-menu").hide();
			$(this).next("ul").show();
		}); 
		
		//其它地方点击关闭邮件
		document.onclick = function(){
			$(".dropdown-menu").hide();
			return true;
		}
		systemManage.showNotice("success", "${message}");
		
		//批量删除
		$("#removeBatch").click(function(){
			delDef();
		});
		
	});
	
	function checkAll(){
		$(".checkId").each(function(index,value){
			if($(value).prop("checked")){
				$(value).removeProp("checked");
			}else{
				$(value).prop("checked","checked");
			}
		});
	}
	
	
	function delRecord(id,pid){
		if(!!id){
			var result = window.confirm("确定要删除所选择的指标吗?");
			if(result){
				var delForm=$("#delForm");
				$("#ids",delForm).val(id);
				$("#pIds",delForm).val(pid);
				delForm.submit();
			}
			return ;
		}
		var ids = [],pids=[];
		$(".checkId").each(function(index,value){
			if($(value).prop("checked")){
				ids.push($(value).val());
				pids.push($(value).data("pid"));
			}
		});
		if(ids.length==0){
			systemManage.showNotice("error", "请选择需要删除的指标!");
		}else{
			var result = window.confirm("确定要删除所选择的指标吗?");
			if(result){
				var delForm=$("#delForm");
				$("#ids",delForm).val(ids.join(","));
				$("#pIds",delForm).val(pids.join(","));
				delForm.submit();
			}
		}
	}
	</script>
</body>
</html>
